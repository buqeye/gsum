
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>Bayesian truncation errors in chiral effective field theory: A Recap &#8212; buqeyemodel 0.1 documentation</title>
    <link rel="stylesheet" href="../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Reference" href="../api.html" />
    <link rel="prev" title="BUQEYE Model" href="bq_test.html" />
  
   

  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../api.html" title="API Reference"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="bq_test.html" title="BUQEYE Model"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">buqeyemodel 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../examples.html" accesskey="U">Examples</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar"><a href="
    ../index.html" class="text-logo">buqeyemodel</a>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="bq_test.html">BUQEYE Model</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Bayesian truncation errors in chiral effective field theory: A Recap</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a></li>
</ul>

    
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Contents</h2>
    <div class="sidebar-localtoc">
      <ul>
<li><a class="reference internal" href="#">Bayesian truncation errors in chiral effective field theory: A Recap</a><ul>
<li><a class="reference internal" href="#Proof-of-Concept">Proof of Concept</a></li>
<li><a class="reference internal" href="#NN-Scattering-Observables">NN Scattering Observables</a><ul>
<li><a class="reference internal" href="#Choose-Hyperparameters">Choose Hyperparameters</a></li>
<li><a class="reference internal" href="#Setup">Setup</a></li>
<li><a class="reference internal" href="#Total-Cross-Section">Total Cross Section</a></li>
<li><a class="reference internal" href="#Differential-Cross-Section">Differential Cross Section</a></li>
<li><a class="reference internal" href="#Model-Checking">Model Checking</a></li>
</ul>
</li>
</ul>
</li>
</ul>

    </div>
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="../search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="../index.html">Docs</a></li>
              
                <li><a href="../examples.html">Examples</a></li>
              
              <li>Bayesian truncation errors in chiral effective field theory: A Recap</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 9ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }
</style>
<div class="nbinput nblast container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">buqeyemodel</span> <span class="kn">as</span> <span class="nn">bq</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="kn">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span><span class="p">,</span> <span class="n">display</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<div class="section" id="Bayesian-truncation-errors-in-chiral-effective-field-theory:-A-Recap">
<h1>Bayesian truncation errors in chiral effective field theory: A Recap<a class="headerlink" href="#Bayesian-truncation-errors-in-chiral-effective-field-theory:-A-Recap" title="Permalink to this headline">¶</a></h1>
<p>Here we reproduce, using the improved truncation error model based on
conjugate priors, some of the results in the following papers</p>
<ul class="simple">
<li>Furnstahl et al., Quantifying Truncation Errors in Effective Field
Theory</li>
<li>Melendez et al., Bayesian truncation errors in chiral effective field
theory: Nucleon-nucleon observables</li>
</ul>
<p>In these papers, the convergence pattern of nucleon-nucleon scattering
observables, including the total and differential cross sections and a
set of spin scattering observables, were studied to infer the effective
field theory (EFT) truncation error. Given the <span class="math">\(k\)</span> lowest order
EFTs, a sequence of observable calculations <span class="math">\(\\{X_0, ..., X_k\\}\)</span>
can be computed for a generic observable <span class="math">\(X\)</span>. It is assumed in the
above papers that one can write the sum of all contributions as</p>
<div class="math">
\begin{align}
    X = X_{\mathrm{ref}}\sum_{n=0}^\infty c_n Q^n
\end{align}</div><p>for iid observable coefficients <span class="math">\(c_n\)</span>. Hence, the <span class="math">\(k\)</span> lowest
orders can be conditioned upon to estimate the remaining higher orders,
and the full summation. The expansion parameter <span class="math">\(Q\)</span> is considered
a ratio of low- and high-energy scales, with the low energy scale a
combination of the relative scattering momentum <span class="math">\(p\)</span> and pion mass
<span class="math">\(m_\pi\)</span>, and the high energy scale is <span class="math">\(\Lambda_b\)</span>, also
known as the breakdown scale. The specific parameterization is</p>
<div class="math">
\begin{align}
    Q = \frac{m_\pi^n + p^n}{m_\pi^{n-1} + p^{n-1}} \frac{1}{\Lambda_b}
\end{align}</div><p>with <span class="math">\(n=8\)</span> used in Melendez et al.</p>
<p>The hierarchical model from the above papers considered the following
prior sets, and Melendez et al. focused on set C with
<span class="math">\(\bar c_&lt; = 0.25\)</span> and <span class="math">\(\bar c_&gt; = 10\)</span>.</p>
<!--- | Set | $pr(c_n | \bar c)$ | $pr(\bar c)$ |
| :---: | :------------------: | :------------: |
| A   | $\frac{1}{2\bar c}\theta(\bar c - |c_n|)$ |  $\frac{1}{\bar c\ln\bar c_> /\bar c_<}\theta(\bar c - \bar c_<) \theta(\bar c_> - \bar c)$ |
| B   | $\frac{1}{2\bar c}\theta(\bar c - |c_n|)$ | $\frac{1}{\sqrt{2\pi}\bar c \sigma} e^{-(\ln \bar c)^2/2\sigma^2}$ |
| C  | $\frac{1}{\sqrt{2\pi}\bar c} e^{-c_n^2/2\bar c}$ | $\frac{1}{\bar c\ln\bar c_> /\bar c_<}\theta(\bar c - \bar c_<) \theta(\bar c_> - \bar c)$ | ---><div class="math">
\begin{array}{ccc} \hline
\mathrm{Set} &amp; pr(c_n | \bar c) &amp; pr(\bar c) \\ \hline
A &amp; \frac{1}{2\bar c}\theta(\bar c - |c_n|) &amp;  \frac{1}{\bar c\ln\bar c_&gt; /\bar c_&lt;}\theta(\bar c - \bar c_&lt;) \theta(\bar c_&gt; - \bar c) \\
B &amp; \frac{1}{2\bar c}\theta(\bar c - |c_n|) &amp;  \frac{1}{\sqrt{2\pi}\bar c \sigma} e^{-(\ln \bar c)^2/2\sigma^2} \\
C &amp; \frac{1}{\sqrt{2\pi}\bar c} e^{-c_n^2/2\bar c} &amp;  \frac{1}{\bar c\ln\bar c_&gt; /\bar c_&lt;}\theta(\bar c - \bar c_&lt;) \theta(\bar c_&gt; - \bar c) \\ \hline
\end{array}</div><p>This package instead employs a conjugate prior set, where the
<span class="math">\(c_n\)</span> are Gaussian and an inverse gamma prior is placed on
<span class="math">\(\bar c^2\)</span>, that is, <span class="math">\(\bar c^2 \sim IG(a, b)\)</span>. Often
<span class="math">\(a\)</span> and <span class="math">\(b\)</span> are called the shape and scale parameters of the
IG distribution, respectively. The inverse gamma density is given by</p>
<div class="math">
\begin{align}
    IG(x; a, b) = \frac{b^a}{\Gamma(a)} x^{-a-1} e^{-b/x}
\end{align}</div><p>Here we compare the results of the very convenient conjugate formulation
to the prior published results.</p>
<div class="section" id="Proof-of-Concept">
<h2>Proof of Concept<a class="headerlink" href="#Proof-of-Concept" title="Permalink to this headline">¶</a></h2>
<p>Many proof of concept tests were performed in Furnstahl et al. Here we
reproduce some of those tests with this package. Since setting
<span class="math">\(a = b = 0\)</span> is equivalent to prior set <span class="math">\(C\)</span> with
<span class="math">\(\bar c_&lt; = 1/\bar c_&gt; = 0\)</span>, the results should be identical in
this case.</p>
<div class="nbinput container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">Q</span> <span class="o">=</span> <span class="mf">0.33</span>

<span class="c1"># Must be 2d array, with orders along the 0th axis</span>
<span class="c1"># These are [c_0, c_1, c_2]</span>
<span class="n">coeffs1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]])</span>
<span class="n">coeffs2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">]])</span>
<span class="n">coeffs3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">]])</span>

<span class="c1"># PowerSeries accepts the *partial sums*, not the coefficients!</span>
<span class="n">partials1</span> <span class="o">=</span> <span class="n">bq</span><span class="o">.</span><span class="n">partials</span><span class="p">(</span><span class="n">coeffs1</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="n">Q</span><span class="p">)</span>
<span class="c1"># Set up model with hyperparameters</span>
<span class="n">test1</span> <span class="o">=</span> <span class="n">bq</span><span class="o">.</span><span class="n">PowerSeries</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
<span class="c1"># Input data and the ratio, hyperparameters get updated here</span>
<span class="n">test1</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">partials</span><span class="o">=</span><span class="n">partials1</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="n">Q</span><span class="p">)</span>
<span class="c1"># Get a scipy.stats.t distribution object for the truncation error</span>
<span class="n">dist1</span> <span class="o">=</span> <span class="n">test1</span><span class="o">.</span><span class="n">predictive</span><span class="p">(</span><span class="n">rescale</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>


<span class="c1"># Repeat for other 2nd set of coefficients</span>
<span class="n">partials2</span> <span class="o">=</span> <span class="n">bq</span><span class="o">.</span><span class="n">partials</span><span class="p">(</span><span class="n">coeffs2</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="n">Q</span><span class="p">)</span>
<span class="n">test2</span> <span class="o">=</span> <span class="n">bq</span><span class="o">.</span><span class="n">PowerSeries</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
<span class="n">test2</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">partials</span><span class="o">=</span><span class="n">partials2</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="n">Q</span><span class="p">)</span>
<span class="n">dist2</span> <span class="o">=</span> <span class="n">test2</span><span class="o">.</span><span class="n">predictive</span><span class="p">(</span><span class="n">rescale</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>


<span class="c1"># Repeat for other 3rd set of coefficients</span>
<span class="n">partials3</span> <span class="o">=</span> <span class="n">bq</span><span class="o">.</span><span class="n">partials</span><span class="p">(</span><span class="n">coeffs3</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="n">Q</span><span class="p">)</span>
<span class="n">test3</span> <span class="o">=</span> <span class="n">bq</span><span class="o">.</span><span class="n">PowerSeries</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
<span class="n">test3</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">partials</span><span class="o">=</span><span class="n">partials3</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="n">Q</span><span class="p">)</span>
<span class="n">dist3</span> <span class="o">=</span> <span class="n">test3</span><span class="o">.</span><span class="n">predictive</span><span class="p">(</span><span class="n">rescale</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>


<span class="c1"># Plot the results</span>
<span class="n">Deltaks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">coeffs</span> <span class="o">=</span> <span class="p">[</span><span class="n">coeffs1</span><span class="p">,</span> <span class="n">coeffs2</span><span class="p">,</span> <span class="n">coeffs3</span><span class="p">]</span>
<span class="n">dists</span> <span class="o">=</span> <span class="p">[</span><span class="n">dist1</span><span class="p">,</span> <span class="n">dist2</span><span class="p">,</span> <span class="n">dist3</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axs</span><span class="o">.</span><span class="n">ravel</span><span class="p">()):</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">dists</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Deltaks</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">Deltaks</span><span class="p">))</span>

    <span class="c1"># Plot dob intervals as vertical lines</span>
    <span class="n">dob68</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="mf">0.68</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">dob</span> <span class="ow">in</span> <span class="n">dob68</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dob</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">dob</span><span class="p">)],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">dob95</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="mf">0.95</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">dob</span> <span class="ow">in</span> <span class="n">dob95</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dob</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">dob</span><span class="p">)],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="c1"># Format the plot as in Furnstahl et al. for comparison</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;pr($\Delta_2$ | c={coeffs})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">coeffs</span><span class="o">=</span><span class="n">coeffs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\Delta_2$&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">17</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.13</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mi">31</span><span class="p">)))</span>
    <span class="c1"># ax.grid(axis=&#39;y&#39;)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="prompt empty container">
</div>
<div class="output_area container">
<img alt="../_images/notebooks_truncation_recap_3_0.png" src="../_images/notebooks_truncation_recap_3_0.png" />
</div>
</div>
<p>Compare the above figure with the blue curves from Fig. 4 in Furnstahl
et al., reproduced below:</p>
<!--- Html img tags are removed by nbsphinx and using one image is obnoxiously large... live with this for now ---><table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><img alt="image0" src="../_images/Delta_k2_z0p33_setA_vs_setC_a.pdf" /></td>
<td><img alt="image1" src="../_images/Delta_k2_z0p33_setA_vs_setC_b.pdf" /></td>
<td><img alt="image2" src="../_images/Delta_k2_z0p33_setA_vs_setC_c.pdf" /></td>
</tr>
</tbody>
</table>
<p>The original paper states that Fig. 4 uses the “leading-omitted-term
approximation” to the truncation error, but this is a misprint. Thus,
the curves are indeed identical. Of course, this package allows any
<span class="math">\(a\)</span> and <span class="math">\(b\)</span> to be chosen instead, each of which allow pdfs
of <span class="math">\(\Delta_k\)</span> to be computed efficiently without any manual
integration.</p>
</div>
<div class="section" id="NN-Scattering-Observables">
<h2>NN Scattering Observables<a class="headerlink" href="#NN-Scattering-Observables" title="Permalink to this headline">¶</a></h2>
<p>Although the total cross section was covered in Furnstahl et al., it and
other observables were more extensively studied in Melendez et al. Here
we will reproduce some of the key figures from Melendez et al. with a
slightly altered prior on <span class="math">\(\bar c\)</span>.</p>
<div class="section" id="Choose-Hyperparameters">
<h3>Choose Hyperparameters<a class="headerlink" href="#Choose-Hyperparameters" title="Permalink to this headline">¶</a></h3>
<p>First let’s figure out the hyperparameters of the inverse gamma
distribution that best reproduce the “Set C” prior with
<span class="math">\(\bar c_&gt; = 10\)</span> and <span class="math">\(\bar c_&lt; = 0.25\)</span>, which was the most
extensively used prior set of Melendez et al.</p>
<div class="nbinput container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">ig</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">invgamma</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="c1"># pr(cbar**2) for set C between 0.25 and 10</span>
    <span class="k">if</span> <span class="mf">0.25</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="o">/</span><span class="mf">0.25</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

<span class="n">cbarsq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">ar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cbarsq</span><span class="p">])</span>

<span class="c1"># plt.semilogy(cbarsq, ig.pdf(cbarsq), label=&#39;ig&#39;)</span>
<span class="c1"># plt.semilogy(cbarsq, ar, label=&#39;Set C&#39;)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cbarsq</span><span class="p">,</span> <span class="n">ig</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">cbarsq</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ig&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cbarsq</span><span class="p">,</span> <span class="n">ar</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Set C&#39;</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\bar c^2$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$pr(\bar c^2)$&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="prompt empty container">
</div>
<div class="output_area container">
<img alt="../_images/notebooks_truncation_recap_8_0.png" src="../_images/notebooks_truncation_recap_8_0.png" />
</div>
</div>
<p>It looks like <span class="math">\(a = 0.3\)</span> and <span class="math">\(b \in (0.07, 0.2)\)</span> work nicely!
Let’s see if we can reproduce old results now.</p>
</div>
<div class="section" id="Setup">
<h3>Setup<a class="headerlink" href="#Setup" title="Permalink to this headline">¶</a></h3>
<p>Observables are considered at many values of the kinematic parameters
<span class="math">\(E_{\mathrm{lab}}\)</span> and <span class="math">\(\theta\)</span>. The expansion parameter is
assumed to vary in energy so we must provide a callable function rather
than a constant as before. Thus we will first define the <code class="docutils literal highlight highlight-default"><span></span><span class="n">ratio</span></code>
function that will be used as the expansion parameter.</p>
<div class="nbinput nblast container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># Constants: proton/neutron masses and hbar</span>
<span class="n">m_p</span> <span class="o">=</span> <span class="mf">938.27208</span>  <span class="c1"># MeV/c^2</span>
<span class="n">m_n</span> <span class="o">=</span> <span class="mf">939.56541</span>  <span class="c1"># MeV/c^2</span>
<span class="n">hbarc</span> <span class="o">=</span> <span class="mf">197.33</span>  <span class="c1"># Mev-fm</span>


<span class="k">def</span> <span class="nf">E_to_p</span><span class="p">(</span><span class="n">E_lab</span><span class="p">,</span> <span class="n">interaction</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return p in MeV.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    energy      = float</span>
<span class="sd">                  lab energy given in MeV.</span>
<span class="sd">    interaction = str</span>
<span class="sd">                  {&quot;pp&quot;, &quot;nn&quot;, &quot;np&quot;}</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">interaction</span> <span class="o">==</span> <span class="s2">&quot;pp&quot;</span><span class="p">:</span>
        <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span> <span class="o">=</span> <span class="n">m_p</span><span class="p">,</span> <span class="n">m_p</span>
    <span class="k">if</span> <span class="n">interaction</span> <span class="o">==</span> <span class="s2">&quot;nn&quot;</span><span class="p">:</span>
        <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span> <span class="o">=</span> <span class="n">m_n</span><span class="p">,</span> <span class="n">m_n</span>
    <span class="k">if</span> <span class="n">interaction</span> <span class="o">==</span> <span class="s2">&quot;np&quot;</span><span class="p">:</span>
        <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span> <span class="o">=</span> <span class="n">m_n</span><span class="p">,</span> <span class="n">m_p</span>
    <span class="n">p_rel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
        <span class="n">E_lab</span> <span class="o">*</span> <span class="n">m2</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">E_lab</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m1</span><span class="p">)</span> <span class="o">/</span>
        <span class="p">((</span><span class="n">m1</span> <span class="o">+</span> <span class="n">m2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m2</span> <span class="o">*</span> <span class="n">E_lab</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">p_rel</span>


<span class="k">def</span> <span class="nf">Q_approx</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">Lambda_b</span><span class="p">,</span> <span class="n">interaction</span><span class="p">,</span> <span class="n">single_expansion</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">single_expansion</span><span class="p">:</span>
        <span class="n">m_pi</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">m_pi</span> <span class="o">=</span> <span class="mi">138</span>  <span class="c1"># Set to 0 to just return p/Lambda_b</span>
    <span class="c1"># Interpolate to smooth the transition from m_pi to p</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">E_to_p</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">interaction</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="p">(</span><span class="n">m_pi</span><span class="o">**</span><span class="n">n</span> <span class="o">+</span> <span class="n">p</span><span class="o">**</span><span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">m_pi</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">p</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">Lambda_b</span>
    <span class="k">return</span> <span class="n">q</span>


<span class="k">def</span> <span class="nf">ratio</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Lambda_b</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Assume energies are in the first column of X&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">Q_approx</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">Lambda_b</span><span class="p">,</span> <span class="n">interaction</span><span class="o">=</span><span class="s1">&#39;np&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Now import the relevant data for each observable</p>
<div class="nbinput nblast container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">dir_path</span> <span class="o">=</span> <span class="s1">&#39;../data/&#39;</span>
<span class="n">pot_type</span> <span class="o">=</span> <span class="s1">&#39;kvnn_41&#39;</span>
<span class="n">observable</span> <span class="o">=</span> <span class="s1">&#39;diff_cross_sec&#39;</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">observable</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">pot_type</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span>

<span class="n">total_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">filepath_or_buffer</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s1">&#39;cross_sec_&#39;</span> <span class="o">+</span> <span class="n">pot_type</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">),</span>
    <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span>
    <span class="p">)</span>
<span class="n">diff_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">filepath_or_buffer</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s1">&#39;diff_cross_sec_&#39;</span> <span class="o">+</span> <span class="n">pot_type</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">),</span>
    <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">]</span>
    <span class="p">)</span>
<span class="n">Ay_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">filepath_or_buffer</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s1">&#39;Ay_&#39;</span> <span class="o">+</span> <span class="n">pot_type</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">),</span>
    <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">]</span>
    <span class="p">)</span>
<span class="n">D_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">filepath_or_buffer</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s1">&#39;D_&#39;</span> <span class="o">+</span> <span class="n">pot_type</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">),</span>
    <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">]</span>
    <span class="p">)</span>
<span class="n">A_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">filepath_or_buffer</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s1">&#39;A_&#39;</span> <span class="o">+</span> <span class="n">pot_type</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">),</span>
    <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">]</span>
    <span class="p">)</span>
<span class="n">Axx_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">filepath_or_buffer</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s1">&#39;Axx_&#39;</span> <span class="o">+</span> <span class="n">pot_type</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">),</span>
    <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">]</span>
    <span class="p">)</span>
<span class="n">Ayy_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">filepath_or_buffer</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s1">&#39;Ayy_&#39;</span> <span class="o">+</span> <span class="n">pot_type</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">),</span>
    <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">]</span>
    <span class="p">)</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span>

<span class="c1"># Nigmegan Partial Wave Analysis, which is used as experimental data</span>
<span class="n">total_npwa_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/npwa_C_t-t-t-t.dat&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">diff_npwa_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/npwa_C_0-0-0-0_energy-96.dat&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The reference scale <span class="math">\(X_{\mathrm{ref}}\)</span> was chosen to be
<span class="math">\(X_0\)</span> for the total and differential cross section, but it was
argued that <span class="math">\(X_{\mathrm{ref}} = 1\)</span> was sufficient for the spin
observables. Here we set up interpolators that could be used with any
energy or <span class="math">\(\theta\)</span> value.</p>
<div class="nbinput nblast container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">energy_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">351</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">theta_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">Xall</span> <span class="o">=</span> <span class="n">bq</span><span class="o">.</span><span class="n">cartesian</span><span class="p">(</span><span class="n">energy_all</span><span class="p">,</span> <span class="n">theta_all</span><span class="p">)</span>

<span class="n">total_refs</span> <span class="o">=</span> <span class="n">total_df</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">total_ref</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">energy_all</span><span class="p">,</span> <span class="n">total_refs</span><span class="p">)</span>

<span class="n">diff_refs</span> <span class="o">=</span> <span class="n">diff_df</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">diff_ref</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">LinearNDInterpolator</span><span class="p">(</span><span class="n">Xall</span><span class="p">,</span> <span class="n">diff_refs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Total-Cross-Section">
<h3>Total Cross Section<a class="headerlink" href="#Total-Cross-Section" title="Permalink to this headline">¶</a></h3>
<p>In Melendez et al., we produced plots of residuals with statistical
error bands for various EFT regulators and also ran model checking
tests. The residual is defined as</p>
<div class="math">
\begin{align}
    X_{\mathrm{res}} \equiv X_{\mathrm{pred}} - X_{\mathrm{exp}}
\end{align}</div><p>First let’s define the values of energies to be used in the analysis and
get the imported data</p>
<div class="nbinput nblast container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># Input data</span>
<span class="n">total_energy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">351</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">total_partials</span> <span class="o">=</span> <span class="n">total_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">:</span><span class="s1">&#39;5&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>

<span class="c1"># Corresponding orders</span>
<span class="n">orders</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="c1"># Ignore these orders in prediction</span>
<span class="n">rm_orders</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>Now set up the hyperparameters that will be used for the model</p>
<div class="nbinput nblast container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">ratio_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Lambda_b&#39;</span><span class="p">:</span> <span class="mi">600</span><span class="p">}</span>

<span class="c1"># From above testing</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">b</span> <span class="o">=</span> <span class="mf">0.2</span>
</pre></div>
</div>
</div>
<p>Let’s start by reproducing the Fig. 7 from Melendez et al.</p>
<div class="nbinput container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># colors = [&#39;orange&#39;, &#39;xkcd:green&#39;, &#39;xkcd:azure&#39;, &#39;xkcd:red&#39;]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;Oranges&quot;</span><span class="p">)(</span><span class="mf">0.4</span><span class="p">),</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;Greens&quot;</span><span class="p">)(</span><span class="mf">0.6</span><span class="p">),</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;Blues&quot;</span><span class="p">)(</span><span class="mf">0.6</span><span class="p">),</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;Reds&quot;</span><span class="p">)(</span><span class="mf">0.6</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">rescale</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">ax_list</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="n">ax_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$E_{\mathrm{lab}}$ (MeV)&#39;</span><span class="p">)</span>
<span class="n">ax_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$E_{\mathrm{lab}}$ (MeV)&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Total Cross Section Residuals&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">max_index</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span>
    <span class="n">sub_orders</span> <span class="o">=</span> <span class="n">orders</span><span class="p">[:</span><span class="n">max_index</span><span class="p">]</span>
    <span class="n">sub_partials</span> <span class="o">=</span> <span class="n">total_partials</span><span class="p">[:</span><span class="n">max_index</span><span class="p">]</span>
    <span class="n">total_cross_sec</span> <span class="o">=</span> <span class="n">bq</span><span class="o">.</span><span class="n">PowerSeries</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
    <span class="n">total_cross_sec</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span>
        <span class="n">X</span><span class="o">=</span><span class="n">total_energy</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">],</span> <span class="n">partials</span><span class="o">=</span><span class="n">sub_partials</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="n">ratio</span><span class="p">,</span>
        <span class="n">orders</span><span class="o">=</span><span class="n">sub_orders</span><span class="p">,</span> <span class="n">rm_orders</span><span class="o">=</span><span class="n">rm_orders</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">total_ref</span><span class="p">(</span><span class="n">total_energy</span><span class="p">),</span> <span class="o">**</span><span class="n">ratio_kwargs</span><span class="p">)</span>
    <span class="n">pred</span><span class="p">,</span> <span class="n">pred_int</span> <span class="o">=</span> <span class="n">total_cross_sec</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dob</span><span class="o">=</span><span class="p">[</span><span class="mf">0.68</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">],</span> <span class="n">rescale</span><span class="o">=</span><span class="n">rescale</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rescale</span><span class="p">:</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="n">pred</span> <span class="o">-</span> <span class="n">total_npwa_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">total_energy</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">pred_int</span> <span class="o">=</span> <span class="n">pred_int</span> <span class="o">-</span> <span class="n">total_npwa_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">total_energy</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="c1"># Format as in Melendez et al.</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">ax_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">13</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">350</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="o">-</span><span class="mi">9</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">total_energy</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">total_energy</span><span class="p">,</span> <span class="n">pred_int</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">total_energy</span><span class="p">,</span> <span class="n">pred_int</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">350</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">10.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;N{}LO&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="prompt empty container">
</div>
<div class="output_area container">
<img alt="../_images/notebooks_truncation_recap_21_0.png" src="../_images/notebooks_truncation_recap_21_0.png" />
</div>
</div>
<p>Compare the above figure with Fig. 7 from Melendez et al.</p>
<div class="figure" id="id1">
<img alt="total cross section residual" src="../_images/subres_C_t-t-t-t_vs_energy-1-351-1_kvnn_61_lam12.0_reg_0_3_0_blatt_ig-0-1_Lambdab-600_lm-1.0_Xref-0dsigma_p-0.68-0.95_prior-C_h-10_cbl-0.25_cbu-10.0_sg-0_orders-NLO-N2LO-N3LO-N4LO.pdf" />
<p class="caption"><span class="caption-text">total cross section residual</span></p>
</div>
</div>
<div class="section" id="Differential-Cross-Section">
<h3>Differential Cross Section<a class="headerlink" href="#Differential-Cross-Section" title="Permalink to this headline">¶</a></h3>
<p>Now set up differential cross section data</p>
<div class="nbinput nblast container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># Input data</span>
<span class="n">diff_energy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">96</span><span class="p">])</span>
<span class="n">diff_theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">X_diff</span> <span class="o">=</span> <span class="n">bq</span><span class="o">.</span><span class="n">cartesian</span><span class="p">(</span><span class="n">diff_energy</span><span class="p">,</span> <span class="n">diff_theta</span><span class="p">)</span>
<span class="n">diff_df_reduced</span> <span class="o">=</span> <span class="n">diff_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">X_diff</span><span class="p">))]</span>
<span class="n">diff_partials</span> <span class="o">=</span> <span class="n">diff_df_reduced</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">:</span><span class="s1">&#39;5&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>

<span class="c1"># Corresponding orders</span>
<span class="n">orders</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="c1"># Ignore these orders in prediction</span>
<span class="n">rm_orders</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>Below we repeat the analysis for the differential cross section</p>
<div class="nbinput container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">rescale</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">ax_list</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="n">ax_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\theta$ (deg)&#39;</span><span class="p">)</span>
<span class="n">ax_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\theta$ (deg)&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Differential Cross Section Residuals&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">max_index</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span>
    <span class="n">sub_orders</span> <span class="o">=</span> <span class="n">orders</span><span class="p">[:</span><span class="n">max_index</span><span class="p">]</span>
    <span class="n">sub_partials</span> <span class="o">=</span> <span class="n">diff_partials</span><span class="p">[:</span><span class="n">max_index</span><span class="p">]</span>
    <span class="n">diff_cross_sec</span> <span class="o">=</span> <span class="n">bq</span><span class="o">.</span><span class="n">PowerSeries</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
    <span class="n">diff_cross_sec</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span>
        <span class="n">X</span><span class="o">=</span><span class="n">X_diff</span><span class="p">,</span> <span class="n">partials</span><span class="o">=</span><span class="n">sub_partials</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="n">ratio</span><span class="p">,</span>
        <span class="n">orders</span><span class="o">=</span><span class="n">sub_orders</span><span class="p">,</span> <span class="n">rm_orders</span><span class="o">=</span><span class="n">rm_orders</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">diff_ref</span><span class="p">(</span><span class="n">X_diff</span><span class="p">),</span> <span class="o">**</span><span class="n">ratio_kwargs</span><span class="p">)</span>
    <span class="n">pred</span><span class="p">,</span> <span class="n">pred_int</span> <span class="o">=</span> <span class="n">diff_cross_sec</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dob</span><span class="o">=</span><span class="p">[</span><span class="mf">0.68</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">],</span> <span class="n">rescale</span><span class="o">=</span><span class="n">rescale</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rescale</span><span class="p">:</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="n">pred</span> <span class="o">-</span> <span class="n">diff_npwa_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">diff_theta</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">pred_int</span> <span class="o">=</span> <span class="n">pred_int</span> <span class="o">-</span> <span class="n">diff_npwa_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">diff_theta</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">ax_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="o">-</span><span class="mf">4.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">180</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">diff_theta</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">diff_theta</span><span class="p">,</span> <span class="n">pred_int</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">diff_theta</span><span class="p">,</span> <span class="n">pred_int</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">20</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">3.75</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;N{}LO&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="prompt empty container">
</div>
<div class="output_area container">
<img alt="../_images/notebooks_truncation_recap_26_0.png" src="../_images/notebooks_truncation_recap_26_0.png" />
</div>
</div>
<p>Compare the above figure with Fig. 8 from Melendez et al.:</p>
<div class="figure" id="id2">
<img alt="differential cross section" src="../_images/subres_C_0-0-0-0_vs_theta-1-180-1_energy-96_kvnn_61_lam12.0_reg_0_3_0_blatt_ig-0-1_Lambdab-600_lm-1.0_Xref-0dsigma_p-0.68-0.95_prior-C_h-10_cbl-0.25_cbu-10.0_sg-0_orders-NLO-N2LO-N3LO-N4LO.pdf" />
<p class="caption"><span class="caption-text">differential cross section</span></p>
</div>
</div>
<div class="section" id="Model-Checking">
<h3>Model Checking<a class="headerlink" href="#Model-Checking" title="Permalink to this headline">¶</a></h3>
<p>Two model checking diagnostics were employed in Melendez et al.,
consistency plots and <span class="math">\(\Lambda_b\)</span> posteriors. Consistency plots
check whether a <span class="math">\(100\alpha\%\)</span> degree of belief interval contains
true value of the truncation error approximately <span class="math">\(100\alpha\%\)</span> of
the time. The data should lie close to the diagonal in the plot below.
The 68% and 95% gray uncertainty bands allow for deviations from the
diagonal due to the finite set of data.</p>
<div class="nbinput container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">energy_consistency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">341</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">total_partials_consistency</span> <span class="o">=</span> <span class="n">total_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">energy_consistency</span><span class="p">,</span> <span class="n">idx</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">:</span><span class="s1">&#39;5&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
<span class="n">total_coeffs_consistency</span> <span class="o">=</span> <span class="n">bq</span><span class="o">.</span><span class="n">coefficients</span><span class="p">(</span>
    <span class="n">partials</span><span class="o">=</span><span class="n">total_partials_consistency</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">energy_consistency</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">],</span>
    <span class="n">ref</span><span class="o">=</span><span class="n">total_ref</span><span class="p">(</span><span class="n">energy_consistency</span><span class="p">),</span> <span class="n">ratio</span><span class="o">=</span><span class="n">ratio</span><span class="p">,</span> <span class="n">orders</span><span class="o">=</span><span class="n">orders</span><span class="p">,</span> <span class="o">**</span><span class="n">ratio_kwargs</span><span class="p">)</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">energy_consistency</span><span class="p">)</span>
<span class="n">success_rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">dobs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;DoB&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Success Rate, $N={}$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Total Cross Section Consistency Plot&#39;</span><span class="p">)</span>
<span class="n">consistency_markers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">]</span>

<span class="c1"># Plot binomial (or, beta) HPDs</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">0.68</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">]:</span>
    <span class="n">hpds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">bq</span><span class="o">.</span><span class="n">HPD</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">N</span><span class="o">*</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">-</span><span class="n">N</span><span class="o">*</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">success_rate</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">success_rate</span><span class="p">,</span> <span class="n">hpds</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">hpds</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>


<span class="c1"># Plot data</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="c1"># Set up data and observable for each order</span>
    <span class="n">total_consistency</span> <span class="o">=</span> <span class="n">bq</span><span class="o">.</span><span class="n">PowerSeries</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
    <span class="n">max_index</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span>
    <span class="n">sub_orders</span> <span class="o">=</span> <span class="n">orders</span><span class="p">[:</span><span class="n">max_index</span><span class="p">]</span>
    <span class="n">sub_partials</span> <span class="o">=</span> <span class="n">total_partials_consistency</span><span class="p">[:</span><span class="n">max_index</span><span class="p">]</span>
    <span class="n">total_consistency</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span>
        <span class="n">X</span><span class="o">=</span><span class="n">energy_consistency</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">],</span> <span class="n">partials</span><span class="o">=</span><span class="n">sub_partials</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="n">ratio</span><span class="p">,</span>
        <span class="n">orders</span><span class="o">=</span><span class="n">sub_orders</span><span class="p">,</span> <span class="n">rm_orders</span><span class="o">=</span><span class="n">rm_orders</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">total_ref</span><span class="p">(</span><span class="n">energy_consistency</span><span class="p">),</span> <span class="o">**</span><span class="n">ratio_kwargs</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">total_partials_consistency</span><span class="p">[</span><span class="n">max_index</span><span class="p">]</span>

    <span class="c1"># Must use leading order approximation if comparing to next order</span>
    <span class="n">D_CI</span> <span class="o">=</span> <span class="n">total_consistency</span><span class="o">.</span><span class="n">credible_diagnostic</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">dobs</span><span class="o">=</span><span class="n">dobs</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">orders</span><span class="p">[</span><span class="n">max_index</span><span class="p">],</span> <span class="n">rescale</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dobs</span><span class="p">,</span> <span class="n">D_CI</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">consistency_markers</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">markeredgewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;N{}LO&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_index</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="prompt empty container">
</div>
<div class="output_area container">
<img alt="../_images/notebooks_truncation_recap_29_0.png" src="../_images/notebooks_truncation_recap_29_0.png" />
</div>
</div>
<p>Again, compare this with Fig. 12 of Melendez et al.:</p>
<div class="figure" id="id3">
<img alt="consistency" src="../_images/cons_sig_vs_perc-10-91-10_kvnn_61_lam12.0_reg_0_3_0_blatt_ig-0-1_Lambdab-600_lm-1.0_Xref-0dsigma_prior-C_h-1_cbl-0.25_cbu-10.0_sg-0_sep-NLO-N2LO-N3LO_theta-vals-0_energy-range-20-341-20.pdf" />
<p class="caption"><span class="caption-text">consistency</span></p>
</div>
<p>The <span class="math">\(\Lambda_b\)</span> posteriors were computed with uninformative Set C
prior, which corresponds exactly to <span class="math">\(a = b = 0\)</span> for the inverse
gamma prior.</p>
<div class="nbinput container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">energies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">96</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">])</span>
<span class="n">thetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">60</span><span class="p">,</span> <span class="mi">120</span><span class="p">])</span>
<span class="n">X_Lb</span> <span class="o">=</span> <span class="n">bq</span><span class="o">.</span><span class="n">cartesian</span><span class="p">(</span><span class="n">energies</span><span class="p">,</span> <span class="n">thetas</span><span class="p">)</span>
<span class="n">Lb_colors</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
<span class="n">Lambda_b_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1501</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">Lb_logprior</span><span class="p">(</span><span class="n">Lambda_b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Melendez et al., Eq. (31)&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="mi">300</span> <span class="o">&lt;</span> <span class="n">Lambda_b</span><span class="p">,</span> <span class="n">Lambda_b</span> <span class="o">&lt;</span> <span class="mi">1500</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">Lambda_b</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

<span class="c1"># Observables</span>
<span class="n">tot_cross</span> <span class="o">=</span> <span class="n">total_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">energies</span><span class="p">,</span> <span class="n">idx</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">:</span><span class="s1">&#39;5&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
<span class="n">diff_cross</span> <span class="o">=</span> <span class="n">diff_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">X_Lb</span><span class="p">)),</span> <span class="n">idx</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">:</span><span class="s1">&#39;5&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
<span class="n">Ay</span> <span class="o">=</span> <span class="n">Ay_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">X_Lb</span><span class="p">)),</span> <span class="n">idx</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">:</span><span class="s1">&#39;5&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">A_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">X_Lb</span><span class="p">)),</span> <span class="n">idx</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">:</span><span class="s1">&#39;5&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
<span class="n">D</span> <span class="o">=</span> <span class="n">D_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">X_Lb</span><span class="p">)),</span> <span class="n">idx</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">:</span><span class="s1">&#39;5&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
<span class="n">Axx</span> <span class="o">=</span> <span class="n">Axx_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">X_Lb</span><span class="p">)),</span> <span class="n">idx</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">:</span><span class="s1">&#39;5&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
<span class="n">Ayy</span> <span class="o">=</span> <span class="n">Ayy_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">X_Lb</span><span class="p">)),</span> <span class="n">idx</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">:</span><span class="s1">&#39;5&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>

<span class="c1"># Combine spin observables</span>
<span class="n">spin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Ay</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">Axx</span><span class="p">,</span> <span class="n">Ayy</span><span class="p">))</span>
<span class="n">X_Lb_spin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">X_Lb</span><span class="p">,</span> <span class="n">X_Lb</span><span class="p">,</span> <span class="n">X_Lb</span><span class="p">,</span> <span class="n">X_Lb</span><span class="p">,</span> <span class="n">X_Lb</span><span class="p">))</span>

<span class="c1"># Set up lists for loop</span>
<span class="n">observable_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">tot_cross</span><span class="p">,</span> <span class="n">diff_cross</span><span class="p">,</span> <span class="n">spin</span><span class="p">]</span>
<span class="n">X_Lb_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">energies</span><span class="p">,</span> <span class="n">X_Lb</span><span class="p">,</span> <span class="n">X_Lb_spin</span><span class="p">]</span>
<span class="n">ref_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">total_ref</span><span class="p">,</span> <span class="n">diff_ref</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Total Cross Section&#39;</span><span class="p">,</span> <span class="s1">&#39;Differential Cross Section&#39;</span><span class="p">,</span> <span class="s1">&#39;Spin Observables&#39;</span><span class="p">]</span>

<span class="c1"># Begin loop for plotting</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">obs_j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">observable_list</span><span class="p">):</span>
    <span class="n">xlb</span> <span class="o">=</span> <span class="n">X_Lb_list</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
    <span class="n">ref_x</span> <span class="o">=</span> <span class="n">xlb</span>
    <span class="k">if</span> <span class="n">xlb</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">xlb</span> <span class="o">=</span> <span class="n">xlb</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">max_ind</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">)):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">obs_j</span><span class="p">[:</span><span class="n">max_ind</span><span class="p">]</span>
        <span class="n">ordrs</span> <span class="o">=</span> <span class="n">orders</span><span class="p">[:</span><span class="n">max_ind</span><span class="p">]</span>
        <span class="n">observable</span> <span class="o">=</span> <span class="n">bq</span><span class="o">.</span><span class="n">PowerSeries</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">observable</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">xlb</span><span class="p">,</span> <span class="n">partials</span><span class="o">=</span><span class="n">obs</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="n">ratio</span><span class="p">,</span>
                <span class="n">orders</span><span class="o">=</span><span class="n">ordrs</span><span class="p">,</span> <span class="n">rm_orders</span><span class="o">=</span><span class="n">rm_orders</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">ref_list</span><span class="p">[</span><span class="n">j</span><span class="p">](</span><span class="n">ref_x</span><span class="p">),</span> <span class="o">**</span><span class="n">ratio_kwargs</span><span class="p">)</span>
        <span class="c1"># Compute posterior</span>
        <span class="n">Lambda_b_pdf</span> <span class="o">=</span> <span class="n">observable</span><span class="o">.</span><span class="n">posterior</span><span class="p">(</span><span class="s1">&#39;Lambda_b&#39;</span><span class="p">,</span> <span class="n">logprior</span><span class="o">=</span><span class="n">Lb_logprior</span><span class="p">,</span> <span class="n">Lambda_b</span><span class="o">=</span><span class="n">Lambda_b_array</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;N{n}LO&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">max_ind</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Lambda_b_array</span><span class="p">,</span> <span class="n">Lambda_b_pdf</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">Lb_colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="c1"># Add shading using highest probability density intervals</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">0.68</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">]:</span>
            <span class="n">hpd_lower</span><span class="p">,</span> <span class="n">hpd_upper</span> <span class="o">=</span> <span class="n">bq</span><span class="o">.</span><span class="n">HPD_pdf</span><span class="p">(</span><span class="n">pdf</span><span class="o">=</span><span class="n">Lambda_b_pdf</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">Lambda_b_array</span><span class="p">,</span>
                                              <span class="n">opt_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;disp&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">})</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Lambda_b_array</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">Lambda_b_pdf</span><span class="p">,</span>
                            <span class="n">where</span><span class="o">=</span><span class="p">((</span><span class="n">hpd_lower</span> <span class="o">&lt;</span> <span class="n">Lambda_b_array</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Lambda_b_array</span> <span class="o">&lt;</span> <span class="n">hpd_upper</span><span class="p">)),</span>
                            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">Lb_colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="c1"># Format plots</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="bp">None</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;pr($\Lambda_b | c$): {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Lambda_b$ [MeV]&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1200</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">900</span><span class="p">,</span> <span class="mi">1200</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="prompt empty container">
</div>
<div class="output_area container">
<img alt="../_images/notebooks_truncation_recap_32_0.png" src="../_images/notebooks_truncation_recap_32_0.png" />
</div>
</div>
<p>Compare the above figure with Fig. 22 of Melendez et al.:</p>
<div class="figure" id="id4">
<img alt="Lambdab" src="../_images/vio_Lambdab_pdf_sigma-dsdO-spins_vs_energy-vals-96-143-200-300_theta-vals-60-120_kvnn_46_lam12.0_reg_0_3_0_blatt_ig-0-1_Xref-0dsigma_prior-C_cbl-0.001_cbu-1000.0_sg-0_Lpr-u_Lbl-300.0_Lbu-1500.0_ords-N3LO-N4LO_cat-Observable_hue-Order.pdf" />
<p class="caption"><span class="caption-text">Lambdab</span></p>
</div>
</div>
</div>
</div>


          </div>
            
  <div class="footer-relations">
    
      <div class="pull-left">
        <a class="btn btn-default" href="bq_test.html" title="previous chapter (use the left arrow)">BUQEYE Model</a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default" href="../api.html" title="next chapter (use the right arrow)">API Reference</a>
      </div>
    </div>
    <div class="clearer"></div>
  
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../api.html" title="API Reference"
             >next</a> |</li>
        <li class="right" >
          <a href="bq_test.html" title="BUQEYE Model"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">buqeyemodel 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../examples.html" >Examples</a> &#187;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../_static/js/bootstrap.js"></script>
  <div class="footer">
    &copy; Copyright 2018, Jordan Melendez. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  </body>
</html>