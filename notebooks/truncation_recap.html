
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>Bayesian truncation errors in chiral effective field theory: A Pointwise Approach &#8212; gsum 0.1 documentation</title>
    <link rel="stylesheet" href="../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Correlated Truncation Errors in Effective Field Theory: The code behind the manuscript" href="correlated_EFT_publication.html" />
    <link rel="prev" title="BUQEYE Model" href="bq_test.html" />
  
   

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="correlated_EFT_publication.html" title="Correlated Truncation Errors in Effective Field Theory: The code behind the manuscript"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="bq_test.html" title="BUQEYE Model"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">gsum 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../examples.html" accesskey="U">Examples</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar"><a href="
    ../index.html" class="text-logo">gsum</a>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="bq_test.html">BUQEYE Model</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Bayesian truncation errors in chiral effective field theory: A Pointwise Approach</a></li>
<li class="toctree-l2"><a class="reference internal" href="correlated_EFT_publication.html">Correlated Truncation Errors in Effective Field Theory: The code behind the manuscript</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a></li>
</ul>

    
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Contents</h2>
    <div class="sidebar-localtoc">
      <ul>
<li><a class="reference internal" href="#">Bayesian truncation errors in chiral effective field theory: A Pointwise Approach</a><ul>
<li><a class="reference internal" href="#Proof-of-Concept">Proof of Concept</a></li>
<li><a class="reference internal" href="#NN-Scattering-Observables">NN Scattering Observables</a><ul>
<li><a class="reference internal" href="#Choose-Hyperparameters">Choose Hyperparameters</a></li>
<li><a class="reference internal" href="#Setup">Setup</a></li>
<li><a class="reference internal" href="#Total-Cross-Section">Total Cross Section</a></li>
<li><a class="reference internal" href="#Differential-Cross-Section">Differential Cross Section</a></li>
<li><a class="reference internal" href="#Model-Checking">Model Checking</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Conclusion">Conclusion</a></li>
</ul>
</li>
</ul>

    </div>
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="../search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="../index.html">Docs</a></li>
              
                <li><a href="../examples.html">Examples</a></li>
              
              <li>Bayesian truncation errors in chiral effective field theory: A Pointwise Approach</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 7ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2

<span class="kn">import</span> <span class="nn">gsum</span> <span class="kn">as</span> <span class="nn">gm</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="kn">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="kn">as</span> <span class="nn">stats</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;text.usetex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">WIDE_IMG_WIDTH</span> <span class="o">=</span> <span class="mi">800</span>
<span class="n">NARROW_IMG_WIDTH</span> <span class="o">=</span> <span class="mi">400</span>
</pre></div>
</div>
</div>
<div class="section" id="Bayesian-truncation-errors-in-chiral-effective-field-theory:-A-Pointwise-Approach">
<h1>Bayesian truncation errors in chiral effective field theory: A Pointwise Approach<a class="headerlink" href="#Bayesian-truncation-errors-in-chiral-effective-field-theory:-A-Pointwise-Approach" title="Permalink to this headline">¶</a></h1>
<p>Here we reproduce, using the improved truncation error model based on conjugate priors, some of the results in the following papers (with some notational changes)</p>
<ul class="simple">
<li><p><a class="reference external" href="https://arxiv.org/abs/1506.01343">Furnstahl et al.</a>, Quantifying Truncation Errors in Effective Field Theory</p></li>
<li><p><a class="reference external" href="https://arxiv.org/abs/1704.03308">Melendez et al.</a>, Bayesian truncation errors in chiral effective field theory: Nucleon-nucleon observables</p></li>
</ul>
<p>In these papers, the convergence pattern of nucleon-nucleon scattering observables, including the total and differential cross sections and a set of spin scattering observables, were studied to infer the effective field theory (EFT) truncation error. Given the <span class="math notranslate nohighlight">\(k\)</span> lowest order EFTs, a sequence of observable calculations <span class="math notranslate nohighlight">\(\\{y_0, ..., y_k\\}\)</span> can be computed for a generic observable <span class="math notranslate nohighlight">\(y\)</span>. It is assumed in the above papers that one can write the sum of all contributions as
<span class="math">\begin{align}
y = y_{\mathrm{ref}}\sum_{n=0}^\infty c_n Q^n
\end{align}</span> for iid observable coefficients <span class="math notranslate nohighlight">\(c_n\)</span>. Hence, the <span class="math notranslate nohighlight">\(k\)</span> lowest orders can be conditioned upon to estimate the remaining higher orders, and the full summation. The expansion parameter <span class="math notranslate nohighlight">\(Q\)</span> is considered a ratio of low- and high-energy scales, with the low energy scale a combination of the relative scattering momentum <span class="math notranslate nohighlight">\(p\)</span> and pion mass <span class="math notranslate nohighlight">\(m_\pi\)</span>, and the high energy scale is <span class="math notranslate nohighlight">\(\Lambda_b\)</span>, also known as the breakdown scale. The specific parameterization is
<span class="math">\begin{align}
Q = \frac{m_\pi^n + p^n}{m_\pi^{n-1} + p^{n-1}} \frac{1}{\Lambda_b}
\end{align}</span> with <span class="math notranslate nohighlight">\(n=8\)</span> used in Melendez et al.</p>
<p>The hierarchical model from the above papers considered the following prior sets, and Melendez et al. focused on set C with <span class="math notranslate nohighlight">\(\bar c_&lt; = 0.25\)</span> and <span class="math notranslate nohighlight">\(\bar c_&gt; = 10\)</span>.</p>
<!--- | Set | $pr(c_n | \bar c)$ | $pr(\bar c)$ |
| :---: | :------------------: | :------------: |
| A   | $\frac{1}{2\bar c}\theta(\bar c - |c_n|)$ |  $\frac{1}{\bar c\ln\bar c_> /\bar c_<}\theta(\bar c - \bar c_<) \theta(\bar c_> - \bar c)$ |
| B   | $\frac{1}{2\bar c}\theta(\bar c - |c_n|)$ | $\frac{1}{\sqrt{2\pi}\bar c \sigma} e^{-(\ln \bar c)^2/2\sigma^2}$ |
| C  | $\frac{1}{\sqrt{2\pi}\bar c} e^{-c_n^2/2\bar c}$ | $\frac{1}{\bar c\ln\bar c_> /\bar c_<}\theta(\bar c - \bar c_<) \theta(\bar c_> - \bar c)$ | ---><p>\begin{array}{ccc} <span class="math">\hline</span> <span class="math">\mathrm{Set}</span> &amp; pr(c_n | <span class="math">\bar `c) & pr(:nbsphinx-math:</span>bar <cite>c) \ :nbsphinx-math:</cite>hline` A &amp; <span class="math">\frac{1}{2\bar c}</span><span class="math">\theta`(:nbsphinx-math:</span>bar <cite>c - |c_n|) &amp; :nbsphinx-math:</cite>frac{1}{bar clnbar <a href="#id5"><span class="problematic" id="id6">c_</span></a>&gt; /bar c_&lt;}`:nbsphinx-math:<cite>theta`(:nbsphinx-math:</cite>bar <cite>c - :nbsphinx-math:</cite>bar <cite>c_&lt;) :nbsphinx-math:</cite>theta`(<span class="math">\bar `c_> - :nbsphinx-math:</span>bar <cite>c) \ B &amp;
:nbsphinx-math:</cite>frac{1}{2bar c}`:nbsphinx-math:<cite>theta`(:nbsphinx-math:</cite>bar <cite>c - |c_n|) &amp; :nbsphinx-math:</cite>frac{1}{sqrt{2pi}bar c sigma}` e<sup>{-(:nbsphinx-math:</sup>ln <cite>:nbsphinx-math:</cite>bar <cite>c)</cite>2/2:nbsphinx-math:<cite>sigma`^2} \ C &amp; :nbsphinx-math:</cite>frac{1}{sqrt{2pi}bar c}` e<sup>{-c_n</sup>2/2:nbsphinx-math:<cite>bar `c} &amp; :nbsphinx-math:</cite>frac{1}{bar clnbar <a href="#id7"><span class="problematic" id="id8">c_</span></a>&gt; /bar c_&lt;}`:nbsphinx-math:<cite>theta`(:nbsphinx-math:</cite>bar <cite>c - :nbsphinx-math:</cite>bar <cite>c_&lt;)
:nbsphinx-math:</cite>theta`(<span class="math">\bar `c_> - :nbsphinx-math:</span>bar <cite>c) \ :nbsphinx-math:</cite>hline` \end{array}</p>
<p>This package instead employs a conjugate prior set, where the <span class="math notranslate nohighlight">\(c_n\)</span> are Gaussian and an inverse <span class="math notranslate nohighlight">\(\chi^2\)</span> is placed on <span class="math notranslate nohighlight">\(\bar c^2\)</span>, <span class="math">\begin{align}
\bar c^2 \sim \chi^{-2}(\nu_0, \tau_0^2)
\end{align}</span> where <span class="math notranslate nohighlight">\(\nu_0\)</span> and <span class="math notranslate nohighlight">\(\tau_0\)</span> are the prior degrees of freedom and scale parameters, respectively. The inverse <span class="math notranslate nohighlight">\(\chi^2\)</span> density is given by <span class="math">\begin{align}
\chi^{-2}(z; \nu, \tau^2) = \frac{(\nu\tau^2/2)^{\nu/2}}{\Gamma(\nu/2)} z^{-\nu/2-1} e^{-\frac{\nu\tau^2}{2z}}
\end{align}</span> Here we compare the results of the very convenient conjugate formulation to the prior published results.</p>
<div class="section" id="Proof-of-Concept">
<h2>Proof of Concept<a class="headerlink" href="#Proof-of-Concept" title="Permalink to this headline">¶</a></h2>
<p>Many proof of concept tests were performed in Furnstahl et al. Here we reproduce some of those tests with this package. Since setting <span class="math notranslate nohighlight">\(\nu = 0\)</span> is equivalent to prior set <span class="math notranslate nohighlight">\(C\)</span> with <span class="math notranslate nohighlight">\(\bar c_&lt; = 1/\bar c_&gt; = 0\)</span>, the results should be identical in this case.</p>
<p>The basic steps for using this uncorrelated model are</p>
<ul class="simple">
<li><p>Define a <code class="docutils literal notranslate"><span class="pre">TruncationPointwise</span></code> model object with hyperparameters <span class="math notranslate nohighlight">\(\nu\)</span> and <span class="math notranslate nohighlight">\(\tau\)</span></p></li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">fit</span></code> method to input the order-by-order predictions, or partial sums, <code class="docutils literal notranslate"><span class="pre">partials</span></code> of the observable, with the expansion parameter <code class="docutils literal notranslate"><span class="pre">ratio</span></code>, and reference scale <code class="docutils literal notranslate"><span class="pre">ref</span></code> used to extract the coefficients of the series</p></li>
<li><p>Call another method, such as <code class="docutils literal notranslate"><span class="pre">predictive</span></code> or <code class="docutils literal notranslate"><span class="pre">predict</span></code> to get posteriors or degree of belief intervals for the truncation error. Below we use <code class="docutils literal notranslate"><span class="pre">predictive</span></code>, which returns a frozen scipy <span class="math notranslate nohighlight">\(t\)</span> distribution object for the truncation error. Then one can use standard methods (see the scipy.stats documentation) to compute its pdf, credible intervals, etc.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df0</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">Q</span> <span class="o">=</span> <span class="mf">0.33</span>

<span class="c1"># Must be 2d array, with orders spanning the last axis (columns)</span>
<span class="n">coeffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>  <span class="c1"># Set 1, orders 0, 1, 2</span>
     <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>  <span class="c1"># Set 2, orders 0, 1, 2</span>
     <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>   <span class="c1"># Set 3, orders 0, 1, 2</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># The truncation model accepts *partial sums*,</span>
<span class="c1"># i.e., order-by-order predictions y_n, not the coefficients!</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">gm</span><span class="o">.</span><span class="n">partials</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="n">Q</span><span class="p">)</span>

<span class="c1"># Set up a scale-invariant truncation object</span>
<span class="n">test1</span> <span class="o">=</span> <span class="n">gm</span><span class="o">.</span><span class="n">TruncationPointwise</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df0</span><span class="p">)</span>

<span class="c1"># Fit the model to data. Hyperparameters get updated here</span>
<span class="n">test1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y1</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="n">Q</span><span class="p">)</span>

<span class="c1"># Get a scipy.stats.t distribution object for the truncation error</span>
<span class="n">dist</span> <span class="o">=</span> <span class="n">test1</span><span class="o">.</span><span class="n">dist_</span>


<span class="c1"># Plot the results</span>
<span class="n">delta_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>  <span class="c1"># Differences from the true y</span>
<span class="n">pdfs</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">delta_k</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span> <span class="o">+</span> <span class="n">y1</span><span class="p">)</span>

<span class="n">dob68</span> <span class="o">=</span> <span class="n">lower68</span><span class="p">,</span> <span class="n">upper68</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="mf">0.68</span><span class="p">)</span>
<span class="n">pdf_heights68</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">lower68</span><span class="p">)</span>
<span class="n">dob95</span> <span class="o">=</span> <span class="n">lower95</span><span class="p">,</span> <span class="n">upper95</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="mf">0.95</span><span class="p">)</span>
<span class="n">pdf_heights95</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">lower95</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">coeffs</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axs</span><span class="o">.</span><span class="n">ravel</span><span class="p">()):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">delta_k</span><span class="p">,</span> <span class="n">pdfs</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># Plot dob intervals as vertical lines</span>
    <span class="k">for</span> <span class="n">dob</span> <span class="ow">in</span> <span class="n">dob68</span><span class="o">-</span><span class="n">y1</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">dob</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pdf_heights68</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">dob</span> <span class="ow">in</span> <span class="n">dob95</span><span class="o">-</span><span class="n">y1</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">dob</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pdf_heights95</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="c1"># Format the plot as in Furnstahl et al. for comparison</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;pr($\Delta_2 \,\vert\, c=[{},\, {},\, {}]$)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">coeffs</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\Delta_2$&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">17</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.13</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mi">31</span><span class="p">)))</span>
    <span class="c1"># ax.grid(axis=&#39;y&#39;)</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_truncation_recap_4_0.png" src="../_images/notebooks_truncation_recap_4_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_truncation_recap_4_1.png" src="../_images/notebooks_truncation_recap_4_1.png" />
</div>
</div>
<p>Compare the above figure with the blue curves from Fig. 4 in Furnstahl et al., reproduced below:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">Image</span><span class="p">(</span><span class="s1">&#39;../images/Furnstahl_fig4.jpg&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">WIDE_IMG_WIDTH</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<a class="reference internal image-reference" href="../_images/notebooks_truncation_recap_6_0.jpeg"><img alt="../_images/notebooks_truncation_recap_6_0.jpeg" src="../_images/notebooks_truncation_recap_6_0.jpeg" style="width: 800px;" /></a>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<a class="reference internal image-reference" href="../_images/notebooks_truncation_recap_6_1.jpeg"><img alt="../_images/notebooks_truncation_recap_6_1.jpeg" src="../_images/notebooks_truncation_recap_6_1.jpeg" style="width: 800px;" /></a>
</div>
</div>
<p>The original paper states that Fig. 4 uses the “leading-omitted-term approximation” to the truncation error, but this is a misprint. Thus, the curves are indeed identical. This package allows any <span class="math notranslate nohighlight">\(\nu\)</span> and <span class="math notranslate nohighlight">\(\tau^2\)</span> to be chosen instead, each of which allow pdfs to be computed efficiently without any manual integration.</p>
</div>
<div class="section" id="NN-Scattering-Observables">
<h2>NN Scattering Observables<a class="headerlink" href="#NN-Scattering-Observables" title="Permalink to this headline">¶</a></h2>
<p>Although the total cross section was covered in Furnstahl et al., it and other observables were more extensively studied in Melendez et al. Here we will reproduce some of the key figures from Melendez et al. with a slightly altered prior on <span class="math notranslate nohighlight">\(\bar c\)</span>.</p>
<div class="section" id="Choose-Hyperparameters">
<h3>Choose Hyperparameters<a class="headerlink" href="#Choose-Hyperparameters" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt>First let’s figure out the hyperparameters of the inverse <span class="math notranslate nohighlight">\(\chi^2\)</span> distribution that best reproduce the “Set C” prior with <span class="math notranslate nohighlight">\(\bar c_&gt; = 10\)</span> and <span class="math notranslate nohighlight">\(\bar c_&lt; = 0.25\)</span>, which was the most extensively used prior set of Melendez et al. Scipy has an inverse gamma distribution, which is equivalent to the inverse <span class="math notranslate nohighlight">\(\chi^2\)</span> distribution, with hyperparameters defined by :nbsphinx-math:<a href="#id1"><span class="problematic" id="id2">`</span></a>begin{align}</dt><dd><p>a &amp; = frac{nu}{2} \
b &amp; = frac{nu tau^2}{2}</p>
</dd>
</dl>
<p>end{align}`</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_test</span> <span class="o">=</span> <span class="mf">0.6</span>
<span class="n">tau_test</span> <span class="o">=</span> <span class="mf">0.8</span>

<span class="n">a_test</span> <span class="o">=</span> <span class="n">df_test</span><span class="o">/</span><span class="mf">2.</span>
<span class="n">b_test</span> <span class="o">=</span> <span class="n">df_test</span> <span class="o">*</span> <span class="n">tau_test</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">ig</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">invgamma</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">a_test</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">b_test</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">cbar_sq_prior_melendez_etal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">):</span>
    <span class="c1"># pr(cbar**2) for set C</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">lower</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">upper</span><span class="p">),</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">upper</span> <span class="o">/</span> <span class="n">lower</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">),</span> <span class="mf">0.</span><span class="p">)</span>

<span class="n">cbarsq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">prior_vals</span> <span class="o">=</span> <span class="n">cbar_sq_prior_melendez_etal</span><span class="p">(</span><span class="n">cbarsq</span><span class="p">,</span> <span class="mf">0.25</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cbarsq</span><span class="p">,</span> <span class="n">ig</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">cbarsq</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\chi^{-2}$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cbarsq</span><span class="p">,</span> <span class="n">prior_vals</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Set C&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\bar c^2$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$pr(\bar c^2)$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_truncation_recap_10_0.png" src="../_images/notebooks_truncation_recap_10_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_truncation_recap_10_1.png" src="../_images/notebooks_truncation_recap_10_1.png" />
</div>
</div>
<p>It looks like <span class="math notranslate nohighlight">\(\nu \approx 0.6\)</span> and <span class="math notranslate nohighlight">\(\tau \approx 0.8\)</span> work nicely! Let’s see if we can reproduce old results now.</p>
</div>
<div class="section" id="Setup">
<h3>Setup<a class="headerlink" href="#Setup" title="Permalink to this headline">¶</a></h3>
<p>Observables are considered at many values of the kinematic parameters <span class="math notranslate nohighlight">\(E_{\mathrm{lab}}\)</span> and <span class="math notranslate nohighlight">\(\theta\)</span>. The expansion parameter is assumed to vary in energy so we must provide a callable function rather than a constant as before. Thus we will first define the <code class="docutils literal notranslate"><span class="pre">ratio</span></code> function that will be used as the expansion parameter.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Constants: proton/neutron masses and hbar</span>
<span class="n">m_p</span> <span class="o">=</span> <span class="mf">938.27208</span>  <span class="c1"># MeV/c^2</span>
<span class="n">m_n</span> <span class="o">=</span> <span class="mf">939.56541</span>  <span class="c1"># MeV/c^2</span>
<span class="n">hbarc</span> <span class="o">=</span> <span class="mf">197.33</span>  <span class="c1"># Mev-fm</span>


<span class="k">def</span> <span class="nf">E_to_p</span><span class="p">(</span><span class="n">E_lab</span><span class="p">,</span> <span class="n">interaction</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return p in MeV.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    energy      = float</span>
<span class="sd">                  lab energy given in MeV.</span>
<span class="sd">    interaction = str</span>
<span class="sd">                  {&quot;pp&quot;, &quot;nn&quot;, &quot;np&quot;}</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">interaction</span> <span class="o">==</span> <span class="s2">&quot;pp&quot;</span><span class="p">:</span>
        <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span> <span class="o">=</span> <span class="n">m_p</span><span class="p">,</span> <span class="n">m_p</span>
    <span class="k">if</span> <span class="n">interaction</span> <span class="o">==</span> <span class="s2">&quot;nn&quot;</span><span class="p">:</span>
        <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span> <span class="o">=</span> <span class="n">m_n</span><span class="p">,</span> <span class="n">m_n</span>
    <span class="k">if</span> <span class="n">interaction</span> <span class="o">==</span> <span class="s2">&quot;np&quot;</span><span class="p">:</span>
        <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span> <span class="o">=</span> <span class="n">m_n</span><span class="p">,</span> <span class="n">m_p</span>
    <span class="n">p_rel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
        <span class="n">E_lab</span> <span class="o">*</span> <span class="n">m2</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">E_lab</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m1</span><span class="p">)</span> <span class="o">/</span>
        <span class="p">((</span><span class="n">m1</span> <span class="o">+</span> <span class="n">m2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m2</span> <span class="o">*</span> <span class="n">E_lab</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">p_rel</span>


<span class="k">def</span> <span class="nf">Q_approx</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">Lambda_b</span><span class="p">,</span> <span class="n">interaction</span><span class="p">,</span> <span class="n">single_expansion</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">single_expansion</span><span class="p">:</span>
        <span class="n">m_pi</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">m_pi</span> <span class="o">=</span> <span class="mi">138</span>  <span class="c1"># Set to 0 to just return p/Lambda_b</span>
    <span class="c1"># Interpolate to smooth the transition from m_pi to p</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">E_to_p</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">interaction</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="p">(</span><span class="n">m_pi</span><span class="o">**</span><span class="n">n</span> <span class="o">+</span> <span class="n">p</span><span class="o">**</span><span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">m_pi</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">p</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">Lambda_b</span>
    <span class="k">return</span> <span class="n">q</span>


<span class="k">def</span> <span class="nf">ratio</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Lambda_b</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Assume energies are in the first column of X&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">Q_approx</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">Lambda_b</span><span class="p">,</span> <span class="n">interaction</span><span class="o">=</span><span class="s1">&#39;np&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Now import the relevant data for each observable from a precomputed hdf5 file (this requires the <code class="docutils literal notranslate"><span class="pre">h5py</span></code> package). Here we use Epelbaum, Krebs, and Meißner’s <span class="math notranslate nohighlight">\(R=0.9\)</span> fm potential up to N<span class="math notranslate nohighlight">\(^4\)</span>LO as the order-by-order predictions, and the pwa93 as experimental data.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="kn">import</span> <span class="nn">tables</span>

<span class="n">nn_url</span> <span class="o">=</span> <span class="s1">&#39;https://github.com/buqeye/buqeyebox/blob/master/nn_scattering/scattering_observables_EKM_R-0p9fm.h5?raw=true&#39;</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">nn_url</span><span class="p">)</span>
<span class="n">h5file</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="s2">&quot;nn_observables_eft.h5&quot;</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s2">&quot;H5FD_CORE&quot;</span><span class="p">,</span>
                          <span class="n">driver_core_image</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span>
                          <span class="n">driver_core_backing_store</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">SGT</span> <span class="o">=</span> <span class="n">h5file</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s1">&#39;/SGT&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">DSG</span> <span class="o">=</span> <span class="n">h5file</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s1">&#39;/DSG&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">AY</span> <span class="o">=</span> <span class="n">h5file</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s1">&#39;/PB&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">h5file</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s1">&#39;/A&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">D</span> <span class="o">=</span> <span class="n">h5file</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s1">&#39;/D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">AXX</span> <span class="o">=</span> <span class="n">h5file</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s1">&#39;/AXX&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">AYY</span> <span class="o">=</span> <span class="n">h5file</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s1">&#39;/AYY&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">q_cm</span> <span class="o">=</span> <span class="n">h5file</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s1">&#39;/q_cm&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">t_lab</span> <span class="o">=</span> <span class="n">h5file</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s1">&#39;/t_lab&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">degrees</span> <span class="o">=</span> <span class="n">h5file</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s1">&#39;/degrees&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">q_cm</span> <span class="o">*=</span> <span class="n">hbarc</span>

<span class="n">nn_online_pot</span> <span class="o">=</span> <span class="s1">&#39;pwa93&#39;</span>
<span class="n">nn_online_url</span> <span class="o">=</span> <span class="s1">&#39;https://github.com/buqeye/buqeyebox/blob/master/nn_scattering/NN-online-Observables.h5?raw=true&#39;</span>
<span class="n">nno_response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">nn_online_url</span><span class="p">)</span>
<span class="n">nn_online_file</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="s2">&quot;nn_online_example.h5&quot;</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s2">&quot;H5FD_CORE&quot;</span><span class="p">,</span>
                          <span class="n">driver_core_image</span><span class="o">=</span><span class="n">nno_response</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span>
                          <span class="n">driver_core_backing_store</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">SGT_nn_online</span> <span class="o">=</span> <span class="n">nn_online_file</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">nn_online_pot</span> <span class="o">+</span> <span class="s1">&#39;/SGT&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">DSG_nn_online</span> <span class="o">=</span> <span class="n">nn_online_file</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">nn_online_pot</span> <span class="o">+</span> <span class="s1">&#39;/DSG&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">AY_nn_online</span> <span class="o">=</span> <span class="n">nn_online_file</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">nn_online_pot</span> <span class="o">+</span> <span class="s1">&#39;/PB&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">A_nn_online</span> <span class="o">=</span> <span class="n">nn_online_file</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">nn_online_pot</span> <span class="o">+</span> <span class="s1">&#39;/A&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">D_nn_online</span> <span class="o">=</span> <span class="n">nn_online_file</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">nn_online_pot</span> <span class="o">+</span> <span class="s1">&#39;/D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">AXX_nn_online</span> <span class="o">=</span> <span class="n">nn_online_file</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">nn_online_pot</span> <span class="o">+</span> <span class="s1">&#39;/AXX&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">AYY_nn_online</span> <span class="o">=</span> <span class="n">nn_online_file</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">nn_online_pot</span> <span class="o">+</span> <span class="s1">&#39;/AYY&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># with h5py.File(nn_url, &#39;r&#39;) as file:</span>
<span class="c1">#     SGT = file[&#39;SGT&#39;][:]</span>
<span class="c1">#     DSG = file[&#39;DSG&#39;][:]</span>
<span class="c1">#     AY = file[&#39;PB&#39;][:]</span>
<span class="c1">#     A = file[&#39;A&#39;][:]</span>
<span class="c1">#     D = file[&#39;D&#39;][:]</span>
<span class="c1">#     AXX = file[&#39;AXX&#39;][:]</span>
<span class="c1">#     AYY = file[&#39;AYY&#39;][:]</span>
<span class="c1">#     q_cm = file[&#39;q_cm&#39;][:]</span>
<span class="c1">#     t_lab = file[&#39;t_lab&#39;][:]</span>
<span class="c1">#     degrees = file[&#39;degrees&#39;][:]</span>

<span class="c1"># q_cm *= hbarc</span>

<span class="c1"># with h5py.File(os.path.expanduser(&#39;~/Desktop/NN-online-Observables.h5&#39;), &#39;r&#39;) as file:</span>
<span class="c1">#     SGT_nn_online = file[nn_online_pot + &#39;/SGT&#39;][:]</span>
<span class="c1">#     DSG_nn_online = file[nn_online_pot + &#39;/DSG&#39;][:, :-1]</span>
<span class="c1">#     AY_nn_online = file[nn_online_pot + &#39;/PB&#39;][:, :-1]</span>
<span class="c1">#     A_nn_online = file[nn_online_pot + &#39;/A&#39;][:, :-1]</span>
<span class="c1">#     D_nn_online = file[nn_online_pot + &#39;/D&#39;][:, :-1]</span>
<span class="c1">#     AXX_nn_online = file[nn_online_pot + &#39;/AXX&#39;][:, :-1]</span>
<span class="c1">#     AYY_nn_online = file[nn_online_pot + &#39;/AYY&#39;][:, :-1]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">SGT</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(5, 350)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(5, 350)
</pre></div>
</div>
</div>
<p>The reference scale <span class="math notranslate nohighlight">\(X_{\mathrm{ref}}\)</span> was chosen to be <span class="math notranslate nohighlight">\(X_0\)</span> for the total and differential cross section, but it was argued that <span class="math notranslate nohighlight">\(X_{\mathrm{ref}} = 1\)</span> was sufficient for the spin observables. Here we set up interpolators that could be used with any energy or <span class="math notranslate nohighlight">\(\theta\)</span> value.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sgt_ref</span> <span class="o">=</span> <span class="n">SGT</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">dsg_ref</span> <span class="o">=</span> <span class="n">DSG</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cmaps</span> <span class="o">=</span> <span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Oranges&#39;</span><span class="p">,</span> <span class="s1">&#39;Greens&#39;</span><span class="p">,</span> <span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="s1">&#39;Reds&#39;</span><span class="p">]]</span>
<span class="c1"># markers = [&#39;o&#39;, &#39;^&#39;, &#39;v&#39;, &#39;s&#39;]</span>
<span class="n">markers</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">dark_col</span> <span class="o">=</span> <span class="mf">0.9</span>
<span class="n">medium_col</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">light_col</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="n">dark_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmap</span><span class="p">(</span><span class="n">dark_col</span><span class="p">)</span> <span class="k">for</span> <span class="n">cmap</span> <span class="ow">in</span> <span class="n">cmaps</span><span class="p">]</span>
<span class="n">medium_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmap</span><span class="p">(</span><span class="n">medium_col</span><span class="p">)</span> <span class="k">for</span> <span class="n">cmap</span> <span class="ow">in</span> <span class="n">cmaps</span><span class="p">]</span>
<span class="n">light_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmap</span><span class="p">(</span><span class="n">light_col</span><span class="p">)</span> <span class="k">for</span> <span class="n">cmap</span> <span class="ow">in</span> <span class="n">cmaps</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Total-Cross-Section">
<h3>Total Cross Section<a class="headerlink" href="#Total-Cross-Section" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt>In Melendez et al., we produced plots of residuals with statistical error bands for various EFT regulators and also ran model checking tests. The residual is defined as :nbsphinx-math:<a href="#id3"><span class="problematic" id="id4">`</span></a>begin{align}</dt><dd><p>y_{mathrm{res}} equiv y_{mathrm{th}} - y_{mathrm{exp}}</p>
</dd>
</dl>
<p>end{align}` First let’s define the values of energies to be used in the analysis and get the imported data</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">orders</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span> <span class="c1"># Chiral EFT orders</span>
<span class="n">nn_excluded</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Ignore these orders in prediction</span>
<span class="n">Lambdab</span> <span class="o">=</span> <span class="mi">600</span>
<span class="n">sgt_ratio</span> <span class="o">=</span> <span class="n">Q_approx</span><span class="p">(</span><span class="n">t_lab</span><span class="p">,</span> <span class="n">Lambdab</span><span class="p">,</span> <span class="n">interaction</span><span class="o">=</span><span class="s1">&#39;np&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">sgt_ratio</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">sgt_ref</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(350,) (350,)
(350,) (350,)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sgt_truncation</span> <span class="o">=</span> <span class="n">gm</span><span class="o">.</span><span class="n">TruncationPointwise</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">excluded</span><span class="o">=</span><span class="n">nn_excluded</span><span class="p">)</span>
<span class="n">sgt_truncation</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">SGT</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="n">sgt_ratio</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">sgt_ref</span><span class="p">,</span> <span class="n">orders</span><span class="o">=</span><span class="n">orders</span><span class="p">)</span>

<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">coeff</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">orders</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">sgt_truncation</span><span class="o">.</span><span class="n">coeffs_</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_lab</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$c_{n}$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">));</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_truncation_recap_22_0.png" src="../_images/notebooks_truncation_recap_22_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_truncation_recap_22_1.png" src="../_images/notebooks_truncation_recap_22_1.png" />
</div>
</div>
<p>Let’s start by reproducing the Fig. 7 from Melendez et al. We will again begin by fitting the model, and then calling <code class="docutils literal notranslate"><span class="pre">interval</span></code> to find the the truncation error bands.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">orders</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
    <span class="c1"># Compute truncation errors for all orders less than y_i, skipping i=0</span>
    <span class="n">sgt_truncation</span> <span class="o">=</span> <span class="n">gm</span><span class="o">.</span><span class="n">TruncationPointwise</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df_test</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">tau_test</span><span class="p">,</span> <span class="n">excluded</span><span class="o">=</span><span class="n">nn_excluded</span><span class="p">)</span>
    <span class="n">sgt_truncation</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">SGT</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="n">sgt_ratio</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">sgt_ref</span><span class="p">,</span> <span class="n">orders</span><span class="o">=</span><span class="n">orders</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">sgt_intervals</span> <span class="o">=</span> <span class="n">sgt_lower</span><span class="p">,</span> <span class="n">sgt_upper</span> <span class="o">=</span> <span class="n">sgt_truncation</span><span class="o">.</span><span class="n">interval</span><span class="p">([</span><span class="mf">0.68</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">])</span> <span class="o">-</span> <span class="n">SGT_nn_online</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">]</span>

    <span class="c1"># Plot lines and bands</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_lab</span><span class="p">,</span> <span class="n">SGT</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">SGT_nn_online</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">dark_colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=</span><span class="n">i</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">t_lab</span><span class="p">,</span> <span class="n">sgt_lower</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">sgt_upper</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">light_colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=</span><span class="n">i</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">t_lab</span><span class="p">,</span> <span class="n">sgt_lower</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">sgt_upper</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">medium_colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=</span><span class="n">i</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>

    <span class="c1"># Format</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">13</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">350</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="o">-</span><span class="mi">9</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">350</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">10.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;N$^{}$LO&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_truncation_recap_24_0.png" src="../_images/notebooks_truncation_recap_24_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_truncation_recap_24_1.png" src="../_images/notebooks_truncation_recap_24_1.png" />
</div>
</div>
<p>Compare the above figure with Fig. 7 from Melendez et al.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">Image</span><span class="p">(</span><span class="s1">&#39;../images/SGT_residuals_R0p9.png&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">NARROW_IMG_WIDTH</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<a class="reference internal image-reference" href="../_images/notebooks_truncation_recap_26_0.png"><img alt="../_images/notebooks_truncation_recap_26_0.png" src="../_images/notebooks_truncation_recap_26_0.png" style="width: 400px;" /></a>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<a class="reference internal image-reference" href="../_images/notebooks_truncation_recap_26_1.png"><img alt="../_images/notebooks_truncation_recap_26_1.png" src="../_images/notebooks_truncation_recap_26_1.png" style="width: 400px;" /></a>
</div>
</div>
</div>
<div class="section" id="Differential-Cross-Section">
<h3>Differential Cross Section<a class="headerlink" href="#Differential-Cross-Section" title="Permalink to this headline">¶</a></h3>
<p>Now set up differential cross section data</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dsg_energy</span> <span class="o">=</span> <span class="mi">96</span>

<span class="n">DSG_1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">DSG</span><span class="p">[:,</span> <span class="n">t_lab</span> <span class="o">==</span> <span class="n">dsg_energy</span><span class="p">])</span>
<span class="n">dsg_ratio</span> <span class="o">=</span> <span class="n">Q_approx</span><span class="p">(</span><span class="n">dsg_energy</span><span class="p">,</span> <span class="n">Lambdab</span><span class="p">,</span> <span class="n">interaction</span><span class="o">=</span><span class="s1">&#39;np&#39;</span><span class="p">)</span>
<span class="n">dsg_ref</span> <span class="o">=</span> <span class="n">DSG_1d</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">DSG_nn_online_1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">DSG_nn_online</span><span class="p">[</span><span class="n">t_lab</span> <span class="o">==</span> <span class="n">dsg_energy</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">DSG_1d</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">DSG_nn_online_1d</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(5, 179) (179,)
(5, 179) (179,)
</pre></div></div>
</div>
<p>Below we repeat the analysis for the differential cross section</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">orders</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
    <span class="c1"># Compute truncation errors for all orders less than y_i, skipping i=0</span>
    <span class="n">dsg_truncation</span> <span class="o">=</span> <span class="n">gm</span><span class="o">.</span><span class="n">TruncationPointwise</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df_test</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">tau_test</span><span class="p">,</span> <span class="n">excluded</span><span class="o">=</span><span class="n">nn_excluded</span><span class="p">)</span>
    <span class="n">dsg_truncation</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">DSG_1d</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="n">dsg_ratio</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">dsg_ref</span><span class="p">,</span> <span class="n">orders</span><span class="o">=</span><span class="n">orders</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">dsg_intervals</span> <span class="o">=</span> <span class="n">dsg_lower</span><span class="p">,</span> <span class="n">dsg_upper</span> <span class="o">=</span> <span class="n">dsg_truncation</span><span class="o">.</span><span class="n">interval</span><span class="p">([</span><span class="mf">0.68</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">])</span> <span class="o">-</span> <span class="n">DSG_nn_online_1d</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">]</span>

    <span class="c1"># Plot lines and bands</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">degrees</span><span class="p">,</span> <span class="n">DSG_1d</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">DSG_nn_online_1d</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">dark_colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=</span><span class="n">i</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">degrees</span><span class="p">,</span> <span class="n">dsg_lower</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">dsg_upper</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">light_colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=</span><span class="n">i</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">degrees</span><span class="p">,</span> <span class="n">dsg_lower</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">dsg_upper</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">medium_colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=</span><span class="n">i</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>

    <span class="c1"># Format</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">179</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="o">-</span><span class="mf">4.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">60</span><span class="p">,</span> <span class="mi">120</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">20</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">3.75</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;N$^{}$LO&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\theta$ (deg)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\theta$ (deg)&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_truncation_recap_30_0.png" src="../_images/notebooks_truncation_recap_30_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_truncation_recap_30_1.png" src="../_images/notebooks_truncation_recap_30_1.png" />
</div>
</div>
<p>Compare the above figure with Fig. 8 from Melendez et al.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">Image</span><span class="p">(</span><span class="s1">&#39;../images/DSG_residuals_R0p9.png&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">NARROW_IMG_WIDTH</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<a class="reference internal image-reference" href="../_images/notebooks_truncation_recap_32_0.png"><img alt="../_images/notebooks_truncation_recap_32_0.png" src="../_images/notebooks_truncation_recap_32_0.png" style="width: 400px;" /></a>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<a class="reference internal image-reference" href="../_images/notebooks_truncation_recap_32_1.png"><img alt="../_images/notebooks_truncation_recap_32_1.png" src="../_images/notebooks_truncation_recap_32_1.png" style="width: 400px;" /></a>
</div>
</div>
</div>
<div class="section" id="Model-Checking">
<h3>Model Checking<a class="headerlink" href="#Model-Checking" title="Permalink to this headline">¶</a></h3>
<p>Two model checking diagnostics were employed in Melendez et al., consistency plots and <span class="math notranslate nohighlight">\(\Lambda_b\)</span> posteriors. Consistency plots check whether a <span class="math notranslate nohighlight">\(100\alpha\%\)</span> degree of belief interval contains true value of the truncation error approximately <span class="math notranslate nohighlight">\(100\alpha\%\)</span> of the time. Validation data can be checked in this manner using the <code class="docutils literal notranslate"><span class="pre">credible_diagnostic</span></code> method, which computes the average number of points contained in a given credible interval. The data should lie close to the
diagonal in the plot below. The 68% and 95% gray uncertainty bands allow for deviations from the diagonal due to the finite set of data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">t_lab_consistency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">341</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">ratio_consistency</span> <span class="o">=</span> <span class="n">Q_approx</span><span class="p">(</span><span class="n">t_lab_consistency</span><span class="p">,</span> <span class="n">Lambdab</span><span class="p">,</span> <span class="n">interaction</span><span class="o">=</span><span class="s1">&#39;np&#39;</span><span class="p">)</span>
<span class="n">SGT_consistency</span> <span class="o">=</span> <span class="n">SGT</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">t_lab</span><span class="p">,</span> <span class="n">t_lab_consistency</span><span class="p">)]</span>
<span class="n">sgt_ref_consistency</span> <span class="o">=</span> <span class="n">SGT_consistency</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_lab_consistency</span><span class="p">)</span>
<span class="n">band_dobs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">dobs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="n">beta</span> <span class="o">=</span> <span class="bp">False</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;DoB&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Success Rate, $N={}$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Total Cross Section Consistency Plot&#39;</span><span class="p">)</span>
<span class="n">consistency_markers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">sgt_cons</span> <span class="o">=</span> <span class="n">gm</span><span class="o">.</span><span class="n">TruncationPointwise</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df_test</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">tau_test</span><span class="p">,</span> <span class="n">excluded</span><span class="o">=</span><span class="n">nn_excluded</span><span class="p">)</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span>
    <span class="n">sgt_cons</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">SGT_consistency</span><span class="p">[:</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="n">ratio_consistency</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">sgt_ref_consistency</span><span class="p">,</span> <span class="n">orders</span><span class="o">=</span><span class="n">orders</span><span class="p">[:</span><span class="n">idx</span><span class="p">])</span>
    <span class="n">D_CI</span><span class="p">,</span> <span class="n">bands</span> <span class="o">=</span> <span class="n">sgt_cons</span><span class="o">.</span><span class="n">credible_diagnostic</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">SGT_consistency</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">dobs</span><span class="o">=</span><span class="n">dobs</span><span class="p">,</span> <span class="n">band_intervals</span><span class="o">=</span><span class="p">[</span><span class="mf">0.68</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">],</span>
        <span class="n">band_dobs</span><span class="o">=</span><span class="n">band_dobs</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dobs</span><span class="p">,</span> <span class="n">D_CI</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">medium_colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">consistency_markers</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">markeredgewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;N$^{}$LO&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># Make gray error bands</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">beta</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">band_dobs</span><span class="p">,</span> <span class="n">bands</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">bands</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">band_dobs</span><span class="p">,</span> <span class="n">bands</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">bands</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">band_dobs</span><span class="p">,</span> <span class="n">bands</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">bands</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">band_dobs</span><span class="p">,</span> <span class="n">bands</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">bands</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_truncation_recap_34_0.png" src="../_images/notebooks_truncation_recap_34_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_truncation_recap_34_1.png" src="../_images/notebooks_truncation_recap_34_1.png" />
</div>
</div>
<p>Again, compare this with Fig. 12 of Melendez et al.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">Image</span><span class="p">(</span><span class="s1">&#39;../images/sgt_consistency.png&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">NARROW_IMG_WIDTH</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<a class="reference internal image-reference" href="../_images/notebooks_truncation_recap_36_0.png"><img alt="../_images/notebooks_truncation_recap_36_0.png" src="../_images/notebooks_truncation_recap_36_0.png" style="width: 400px;" /></a>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<a class="reference internal image-reference" href="../_images/notebooks_truncation_recap_36_1.png"><img alt="../_images/notebooks_truncation_recap_36_1.png" src="../_images/notebooks_truncation_recap_36_1.png" style="width: 400px;" /></a>
</div>
</div>
<p>Each curve shows a slight discrepancy (only a few points) with Fig. 12, but that is expected since the priors are not identical between the figures. Now let’s move on to pr(<span class="math notranslate nohighlight">\(\Lambda_b | c\)</span>). The <span class="math notranslate nohighlight">\(\Lambda_b\)</span> posteriors were computed with uninformative Set C prior, which corresponds exactly to <span class="math notranslate nohighlight">\(\nu_0 = 0\)</span> for the inverse chi squared prior. Thus, the figures generated below should correspond exactly with those in the paper. Below, are some helper functions, including one to call
the <code class="docutils literal notranslate"><span class="pre">log_likelihood</span></code> method, multiply by a prior, normalize the posterior, and extract summary statistics for the <code class="docutils literal notranslate"><span class="pre">Lambda_b</span></code> parameter. Since the posteriors can be quite skewed, a highest probability density interval is calculated using the <code class="docutils literal notranslate"><span class="pre">HPD_pdf</span></code> function, rather than a simple symmetric credible interval.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">Lb_logprior</span><span class="p">(</span><span class="n">Lambda_b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Melendez et al., Eq. (31)&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="mi">300</span> <span class="o">&lt;=</span> <span class="n">Lambda_b</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Lambda_b</span> <span class="o">&lt;=</span> <span class="mi">1500</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">Lambda_b</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">compute_posterior_intervals</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ratios</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">orders</span><span class="p">,</span> <span class="n">max_idx</span><span class="p">,</span> <span class="n">logprior</span><span class="p">,</span> <span class="n">Lb</span><span class="p">):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="n">max_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="n">ratios</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ref</span><span class="o">=</span><span class="n">ref</span><span class="p">,</span> <span class="n">orders</span><span class="o">=</span><span class="n">orders</span><span class="p">[:</span><span class="n">max_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">log_like</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">model</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">(</span><span class="n">ratio</span><span class="o">=</span><span class="n">ratio</span><span class="p">)</span> <span class="k">for</span> <span class="n">ratio</span> <span class="ow">in</span> <span class="n">ratios</span><span class="p">])</span>
    <span class="n">log_like</span> <span class="o">+=</span> <span class="n">logprior</span>
    <span class="n">posterior</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_like</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">log_like</span><span class="p">))</span>
    <span class="n">posterior</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">posterior</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">Lb</span><span class="p">)</span>  <span class="c1"># Normalize</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mf">0.68</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">]):</span>
        <span class="n">bounds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">gm</span><span class="o">.</span><span class="n">hpd_pdf</span><span class="p">(</span><span class="n">pdf</span><span class="o">=</span><span class="n">posterior</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">Lb</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="n">median</span> <span class="o">=</span> <span class="n">gm</span><span class="o">.</span><span class="n">median_pdf</span><span class="p">(</span><span class="n">pdf</span><span class="o">=</span><span class="n">posterior</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">Lb</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">posterior</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">median</span>


<span class="k">def</span> <span class="nf">draw_summary_statistics</span><span class="p">(</span><span class="n">bounds68</span><span class="p">,</span> <span class="n">bounds95</span><span class="p">,</span> <span class="n">median</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bounds68</span><span class="p">,</span> <span class="p">[</span><span class="n">height</span><span class="p">,</span> <span class="n">height</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;darkgrey&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">solid_capstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bounds95</span><span class="p">,</span> <span class="p">[</span><span class="n">height</span><span class="p">,</span> <span class="n">height</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;darkgrey&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">solid_capstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">median</span><span class="p">],</span> <span class="p">[</span><span class="n">height</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">t_lab_Lb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">96</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">])</span>
<span class="n">degrees_Lb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">60</span><span class="p">,</span> <span class="mi">120</span><span class="p">])</span>
<span class="n">X_Lb</span> <span class="o">=</span> <span class="n">gm</span><span class="o">.</span><span class="n">cartesian</span><span class="p">(</span><span class="n">t_lab_Lb</span><span class="p">,</span> <span class="n">degrees_Lb</span><span class="p">)</span>
<span class="n">Lb_colors</span> <span class="o">=</span> <span class="n">light_colors</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
<span class="n">Lambda_b_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1501</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># scale invariant: df = 0</span>
<span class="n">Lb_model</span> <span class="o">=</span> <span class="n">gm</span><span class="o">.</span><span class="n">TruncationPointwise</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">excluded</span><span class="o">=</span><span class="n">nn_excluded</span><span class="p">)</span>

<span class="n">ratios_sgt_Lb</span> <span class="o">=</span> <span class="p">[</span><span class="n">Q_approx</span><span class="p">(</span><span class="n">t_lab_Lb</span><span class="p">,</span> <span class="n">Lb</span><span class="p">,</span> <span class="n">interaction</span><span class="o">=</span><span class="s1">&#39;np&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">Lb</span> <span class="ow">in</span> <span class="n">Lambda_b_array</span><span class="p">]</span>
<span class="n">ratios_dsg_Lb</span> <span class="o">=</span> <span class="p">[</span><span class="n">Q_approx</span><span class="p">(</span><span class="n">X_Lb</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">Lb</span><span class="p">,</span> <span class="n">interaction</span><span class="o">=</span><span class="s1">&#39;np&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">Lb</span> <span class="ow">in</span> <span class="n">Lambda_b_array</span><span class="p">]</span>
<span class="n">logprior</span> <span class="o">=</span> <span class="n">Lb_logprior</span><span class="p">(</span><span class="n">Lambda_b_array</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Mask unused SGT data, and compute results</span>
<span class="n">sgt_Lb</span> <span class="o">=</span> <span class="n">SGT</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">t_lab</span><span class="p">,</span> <span class="n">t_lab_Lb</span><span class="p">)]</span>
<span class="n">sgt_Lb_n3lo_result</span> <span class="o">=</span> <span class="n">compute_posterior_intervals</span><span class="p">(</span>
    <span class="n">Lb_model</span><span class="p">,</span> <span class="n">sgt_Lb</span><span class="p">,</span> <span class="n">ratios_sgt_Lb</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">sgt_Lb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">orders</span><span class="o">=</span><span class="n">orders</span><span class="p">,</span> <span class="n">max_idx</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">logprior</span><span class="o">=</span><span class="n">logprior</span><span class="p">,</span> <span class="n">Lb</span><span class="o">=</span><span class="n">Lambda_b_array</span><span class="p">)</span>
<span class="n">sgt_Lb_n4lo_result</span> <span class="o">=</span> <span class="n">compute_posterior_intervals</span><span class="p">(</span>
    <span class="n">Lb_model</span><span class="p">,</span> <span class="n">sgt_Lb</span><span class="p">,</span> <span class="n">ratios_sgt_Lb</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">sgt_Lb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">orders</span><span class="o">=</span><span class="n">orders</span><span class="p">,</span> <span class="n">max_idx</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">logprior</span><span class="o">=</span><span class="n">logprior</span><span class="p">,</span> <span class="n">Lb</span><span class="o">=</span><span class="n">Lambda_b_array</span><span class="p">)</span>

<span class="c1"># Mask unused DSG data, and compute results</span>
<span class="n">dsg_Lb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">DSG</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">t_lab</span><span class="p">,</span> <span class="n">t_lab_Lb</span><span class="p">)][</span><span class="o">...</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">degrees</span><span class="p">,</span> <span class="n">degrees_Lb</span><span class="p">)],</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">orders</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="n">dsg_Lb_n3lo_result</span> <span class="o">=</span> <span class="n">compute_posterior_intervals</span><span class="p">(</span>
    <span class="n">Lb_model</span><span class="p">,</span> <span class="n">dsg_Lb</span><span class="p">,</span> <span class="n">ratios_dsg_Lb</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">dsg_Lb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">orders</span><span class="o">=</span><span class="n">orders</span><span class="p">,</span> <span class="n">max_idx</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">logprior</span><span class="o">=</span><span class="n">logprior</span><span class="p">,</span> <span class="n">Lb</span><span class="o">=</span><span class="n">Lambda_b_array</span><span class="p">)</span>
<span class="n">dsg_Lb_n4lo_result</span> <span class="o">=</span> <span class="n">compute_posterior_intervals</span><span class="p">(</span>
    <span class="n">Lb_model</span><span class="p">,</span> <span class="n">dsg_Lb</span><span class="p">,</span> <span class="n">ratios_dsg_Lb</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">dsg_Lb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">orders</span><span class="o">=</span><span class="n">orders</span><span class="p">,</span> <span class="n">max_idx</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">logprior</span><span class="o">=</span><span class="n">logprior</span><span class="p">,</span> <span class="n">Lb</span><span class="o">=</span><span class="n">Lambda_b_array</span><span class="p">)</span>

<span class="c1"># Concatenate all spin observable data into one long vector, and compute results</span>
<span class="n">spins_Lb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span>
    <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">spin</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">t_lab</span><span class="p">,</span> <span class="n">t_lab_Lb</span><span class="p">)][</span><span class="o">...</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">degrees</span><span class="p">,</span> <span class="n">degrees_Lb</span><span class="p">)],</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">orders</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">spin</span> <span class="ow">in</span> <span class="p">[</span><span class="n">AY</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">AXX</span><span class="p">,</span> <span class="n">AYY</span><span class="p">]],</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ratios_spins_Lb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">ratios_dsg_Lb</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">AY</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">AXX</span><span class="p">,</span> <span class="n">AYY</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">spins_Lb_n3lo_result</span> <span class="o">=</span> <span class="n">compute_posterior_intervals</span><span class="p">(</span>
    <span class="n">Lb_model</span><span class="p">,</span> <span class="n">spins_Lb</span><span class="p">,</span> <span class="n">ratios_spins_Lb</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">orders</span><span class="o">=</span><span class="n">orders</span><span class="p">,</span> <span class="n">max_idx</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">logprior</span><span class="o">=</span><span class="n">logprior</span><span class="p">,</span> <span class="n">Lb</span><span class="o">=</span><span class="n">Lambda_b_array</span><span class="p">)</span>
<span class="n">spins_Lb_n4lo_result</span> <span class="o">=</span> <span class="n">compute_posterior_intervals</span><span class="p">(</span>
    <span class="n">Lb_model</span><span class="p">,</span> <span class="n">spins_Lb</span><span class="p">,</span> <span class="n">ratios_spins_Lb</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">orders</span><span class="o">=</span><span class="n">orders</span><span class="p">,</span> <span class="n">max_idx</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">logprior</span><span class="o">=</span><span class="n">logprior</span><span class="p">,</span> <span class="n">Lb</span><span class="o">=</span><span class="n">Lambda_b_array</span><span class="p">)</span>

<span class="c1"># Gather the above results</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">sgt_Lb_n3lo_result</span><span class="p">,</span> <span class="n">sgt_Lb_n4lo_result</span><span class="p">,</span>
    <span class="n">dsg_Lb_n3lo_result</span><span class="p">,</span> <span class="n">dsg_Lb_n4lo_result</span><span class="p">,</span>
    <span class="n">spins_Lb_n3lo_result</span><span class="p">,</span> <span class="n">spins_Lb_n4lo_result</span>
<span class="p">]</span>

<span class="c1"># Plot each posterior and its summary statistics</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">posterior</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">median</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
    <span class="n">posterior</span> <span class="o">=</span> <span class="n">posterior</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">posterior</span><span class="p">))</span>  <span class="c1"># Scale so they&#39;re all the same height</span>
    <span class="c1"># Make the lines taper off</span>
    <span class="n">Lb_vals</span> <span class="o">=</span> <span class="n">Lambda_b_array</span><span class="p">[</span><span class="n">posterior</span> <span class="o">&gt;</span> <span class="mf">1e-2</span><span class="p">]</span>
    <span class="n">posterior</span> <span class="o">=</span> <span class="n">posterior</span><span class="p">[</span><span class="n">posterior</span> <span class="o">&gt;</span> <span class="mf">1e-2</span><span class="p">]</span>
    <span class="c1"># Plot and fill posterior, and add summary statistics</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Lb_vals</span><span class="p">,</span> <span class="n">posterior</span><span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;darkgrey&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">Lb_vals</span><span class="p">,</span> <span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="n">posterior</span><span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">Lb_colors</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">draw_summary_statistics</span><span class="p">(</span><span class="o">*</span><span class="n">bounds</span><span class="p">,</span> <span class="n">median</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">height</span><span class="o">=-</span><span class="n">i</span><span class="p">)</span>

<span class="c1"># Plot formatting</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.1</span><span class="p">],</span> <span class="n">minor</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="sa">r</span><span class="s1">&#39;$\sigma$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\displaystyle\frac{d\sigma}{d\Omega}$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$X_{pqik}$&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1200</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">900</span><span class="p">,</span> <span class="mi">1200</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Lambda_b$ (MeV)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axisbelow</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_truncation_recap_40_0.png" src="../_images/notebooks_truncation_recap_40_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_truncation_recap_40_1.png" src="../_images/notebooks_truncation_recap_40_1.png" />
</div>
</div>
<p>Compare the above figure with Fig. 22 of Melendez et al.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">Image</span><span class="p">(</span><span class="s1">&#39;../images/Lambdab_posteriors.png&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">NARROW_IMG_WIDTH</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<a class="reference internal image-reference" href="../_images/notebooks_truncation_recap_42_0.png"><img alt="../_images/notebooks_truncation_recap_42_0.png" src="../_images/notebooks_truncation_recap_42_0.png" style="width: 400px;" /></a>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<a class="reference internal image-reference" href="../_images/notebooks_truncation_recap_42_1.png"><img alt="../_images/notebooks_truncation_recap_42_1.png" src="../_images/notebooks_truncation_recap_42_1.png" style="width: 400px;" /></a>
</div>
</div>
</div>
</div>
<div class="section" id="Conclusion">
<h2>Conclusion<a class="headerlink" href="#Conclusion" title="Permalink to this headline">¶</a></h2>
<p>We have regenerated important figures from Furnstahl et al. and Melendez et al. This code is significantly more condensed, efficient, and reusable than the original. We believe that the ease with which results can be obtained with this package can greatly expand its domain of applicability.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
            
  <div class="footer-relations">
    
      <div class="pull-left">
        <a class="btn btn-default" href="bq_test.html" title="previous chapter (use the left arrow)">BUQEYE Model</a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default" href="correlated_EFT_publication.html" title="next chapter (use the right arrow)">Correlated Truncation Errors in Effective Field Theory: The code behind the manuscript</a>
      </div>
    </div>
    <div class="clearer"></div>
  
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="correlated_EFT_publication.html" title="Correlated Truncation Errors in Effective Field Theory: The code behind the manuscript"
             >next</a> |</li>
        <li class="right" >
          <a href="bq_test.html" title="BUQEYE Model"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">gsum 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../examples.html" >Examples</a> &#187;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../_static/js/bootstrap.js"></script>
  <div class="footer">
    &copy; Copyright 2018, Jordan Melendez. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  </body>
</html>